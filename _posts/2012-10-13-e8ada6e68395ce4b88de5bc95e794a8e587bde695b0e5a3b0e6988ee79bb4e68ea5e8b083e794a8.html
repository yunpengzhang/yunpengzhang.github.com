---
author: admin
comments: true
date: 2012-10-13 15:15:24+00:00
layout: post
slug: '%e8%ad%a6%e6%83%95c%e4%b8%8d%e5%bc%95%e7%94%a8%e5%87%bd%e6%95%b0%e5%a3%b0%e6%98%8e%e7%9b%b4%e6%8e%a5%e8%b0%83%e7%94%a8'
title: 警惕：函数被定义或声明前被调用
wordpress_id: 522
categories:
- c/c++
tags:
- C C语言 陷阱与缺陷
---

<span style="color: #0000ff;">如果一个函数在被定义或声明前被调用，那么返回类型就默认为整型！</span>有时会产生预想不到的结果，而且很难发现错误。

<span style="color: #0000ff;">在编译C程序时要加如-Wall选项，不要放过一个warning，调用的函数要引用相应的头文件，在头文件中有函数声明。</span>

最好是加上-Werror选项，要保持代码没warning。

<!--more-->

cal.h内容
<pre class="lang:c++ decode:true" title="cal.h">#ifndef _CAL_H_
#define _CAL_H_
#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;

uint64_t calfunc(uint64_t x);
#endif</pre>
cal.c内容
<pre class="lang:c++ decode:true" title="cal.c">#include &lt;stdio.h&gt;
#include &lt;stdio.h&gt;
#include "cal.h"

uint64_t calfunc(uint64_t x)
{
	uint64_t ret = x * 1000000;
	return ret;
}</pre>
main.c
<pre class="lang:c++ decode:true">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
/*#include "cal.h"*/

int main(int argc, char **argv)
{
	uint64_t x = 12345678912345;
	uint64_t ret = calfunc(x);
	printf("ret = %llu\n", ret);
	return 0;
}</pre>
如果包含cal.h文件，执行正常，打印

ret = 12345678912345000000

否则打印

ret = 18446744071584794688

因为0xab54a98f815ac840在返回的时候当作int返回，被截断然后复制为0xffffffff815ac840